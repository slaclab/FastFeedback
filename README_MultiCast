#==============================================================
#
#  Name: README_MultiCast
#
#  Rem:  This is the top level directory for the LCLS
#        Feedback Controller IOC Application. 
#
#  Loc:  /afs/slac/g/lcls/build/epics/iocTop/FastFeedback
#
#  Auth: 06-Apr-2010, L. Piccoli      (lpiccoli)
#           May-2015, A. Babbitt      (ababbitt)
#  Rev:  dd-mmm-yyyy, Reviewer's Name (USERNAME)
#--------------------------------------------------------------
#  Mod:
#        dd-mmm-yyyy, Reviewer's Name (USERNAME)
#          coment
#
#        20-May-2016, ababbitt
#        Added more information regarding setting FCOM/UDP/Multicast groups
#==============================================================

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

How udpComm works/Configuration:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


Route setup defines where outgoing multicasts go and which interface
-- by default -- joins a MC group a socket is configured for MC reception.

Instead of the kernel routing tables you can also use the user-mode routines
'udpCommSetIfMcastOut()' to tell udpComm which way to send multicasts
and 'udpCommSetIfMcastImp()', respectively, for reception.

These udpComm commands override the kernel route setup but they are
global (to the udpcomm library), i.e., you cannot use different interfaces
for different sockets (which you can do with the kernel) within a single
instance of the library.

You an use these from a IOC startup script.

The RTEMS BPMs always use the correct interface because they use the
non-tcp/ip implementation of udpComm (which uses a dedicated nic).

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Additional Resources for FCOM/UDP/Multicast:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Also mentioned in <udpComm.h> and udpComm/src/README


Example: Your node sees the BPM multicast input because it has joined the multicast group.  It needs the multicast route so that It can send multicasts.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

More Options Regarding Setting up MultiCast groups:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Regarding MC reception:

AFAIK under linux a 'node' would be a network interface.
I.e., when joining a MC group (again - AFAIK and I might stand corrected)
    only a particular interface joins the group. The interface is
    passed together with the MC group address when joining
    (setsockopt(IP_ADD_MEMBERSHIP).

     If the user does not specify a particular network interface
     then the kernel uses the routing tables and the MC group
     address to select an interface.

     I.e., if the user does not specify an interface then the
     routing tables are not only relevant for transmission but
     also for reception.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Setting up FCOM network interfaces on Development (Inclusion of Email Notes):

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
HOW to modify the multicast routing tables:


That was simple, just logged as root to the console and:

route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         rtrg-lclsdev.sl 0.0.0.0         UG    0      0        0 eth0
134.79.216.0    *               255.255.252.0   U     0      0        0 eth0
172.25.160.0    *               255.255.255.0   U     0      0        0 eth1
#
ip route add 224.0.0.0/4 dev eth1
#
route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         rtrg-lclsdev.sl 0.0.0.0         UG    0      0        0 eth0
134.79.216.0    *               255.255.252.0   U     0      0        0 eth0
172.25.160.0    *               255.255.255.0   U     0      0        0 eth1
224.0.0.0       *               240.0.0.0       U     0      0        0 eth1
#
#
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ORIGINAL PROBLEM:  Were not able to communicate between LinuxRT IOC and RTEMS IOC over FCOM
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This does not solve the magnet issue, just allow us to start debugging it in dev.
#
#
In any case: I assume you have multiple network interfaces. Have you
made sure the FCOM multicast
messages are sent out the correct one (use tcpdump to check)?
If you don't do anything then multicasts will probably go the default
route which might not be correct. You can either modify the routing tables - or, since
that requires root privilege, you can use int udpCommSetIfMcastOut(int sd, uint32_t ifipaddr);
#
(see udpComm.h) in your code.











































































































#
