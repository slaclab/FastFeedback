#!/bin/sh

caput FBCK:FB05:TR05:STATE 0

# 5 Hz
caput -a FBCK:FB05:TR05:POI1 21 0 0 0 0 0 0 0 64 0 0 55 0 0 0 0 0 0 0 0 0 0

# F matrix (11x5)
#caput -a FBCK:FB05:TR05:FMATRIX 80 1 0 0 0 3 1.2336 12.0838 0 0 3 0.80216 17.442 0 0 3 0.80077 34.2755 0 0 3 0.52531 35.9228 0 0 3 0.48296 52.7549 0 0 3 0.14431 36.5211 0 0 3 -0.10361 41.0275 0 0 3 0 0 1 0 3 0 0 0.72412 12.0859 3 0 0 0.84202 30.3833 3 0 0 0.46929 32.9956 3 0 0 0.32778 45.9746 3 0 0 0.053231 39.0996 3 0 0 -0.17939 56.6196 3 0 0 -0.30464 42.04 3

caput -a FBCK:FB05:TR05:FMATRIX 70 1.04909 11.8792 0 0 0 -0.113081 2.93361 0 0 0 -1.18527 -1.94021 0 0 0 -1.42451 -7.88451 0 0 0 -2.7971 -19.0023 0 0 0 -1.5987 -13.45330 0 0 0 -2.02595 -21.3613 0 0 0 0 0 -1.22459 1.6693 0 0 0 -2.1438 -0.742582 0 0 0 -0.79721 -3.75735 0 0 0 -0.247458 -9.91382 0 0 0 0.998747 -5.94374 0 0 0 2.72029 -7.55056 0 0 0 2.25947 1.82984 0

# 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

# G matrix (4x6 - 4 states and 6 actuators)
caput -a FBCK:FB05:TR05:GMATRIX 24 40.6989 11.7045 11.7045 0 0 0 0.26212 1.2272 1.2272 0 0 0 0 0 0 57.6449 28.9045 28.9045 0 0 0 -0.031785 0.82263 0.882263

caput -a FBCK:FB05:TR05:GMATRIX 24 -42.7687 13.1451 7.50854 -2.6882e-15 -4.27951e-15 -4.37535e-15 0.838718 -1.73436 0.930751 1.45627e-16 1.5377e-16 -2.94637e-16 2.35559e-15 -3.83916e-16 1.334e-15 40.6749 33.9377 16.5505 -8.01158e-17 -2.39405e-17 1.56376e-16 0.954711 2.71576 1.5584

#[softegr@lcls-builder FFController]$ caget FBCK:FB05:TR05:FMATRIX
#FBCK:FB05:TR05:FMATRIX 200 1.04909 11.8792 0 0 0 -0.113081 2.93361 0 0 0 -1.18527 -1.94021 0 0 0 -1.42451 -7.88451 0 0 0 -2.7971 -19.0023 0 0 0 -1.5987 -13.45330 0 0 -2.02595 -21.3613 0 0 0 0 0 -1.22459 1.6693 0 0 0 -2.1438 -0.742582 0 0 0 -0.79721 -3.75735 0 0 0 -0.247458 -9.91382 0 0 0 0.998747 -5.94374 0 0 0 2.72029-7.55056 0 0 0 2.25947 1.82984 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

# Loop configs
caput FBCK:FB05:TR05:NAME UndulatorLaunchFile
caput FBCK:FB05:TR05:INSTALLED 1
caput FBCK:FB05:TR05:TOTALPOI 1
#caput FBCK:FB05:TR05:ITERATEFUNC TrajectoryFitPoly
#caput FBCK:FB05:TR05:ITERATEFUNC TrajectoryFitPoly1
#caput FBCK:FB05:TR05:ITERATEFUNC TrajectoryFitBy1
caput FBCK:FB05:TR05:ITERATEFUNC TrajectoryFitPinv

# Measurements
caput FBCK:FB05:TR05:M1DEVNAME FILE:/data/TR05/BPMS:UND1:100:X
caput FBCK:FB05:TR05:M1USED 0
caput FBCK:FB05:TR05:M1CAMODE 1

caput FBCK:FB05:TR05:M2DEVNAME FILE:/data/TR05/BPMS:UND1:190:X
caput FBCK:FB05:TR05:M2USED 0
caput FBCK:FB05:TR05:M2CAMODE 1

caput FBCK:FB05:TR05:M3DEVNAME FILE:/data/TR05/BPMS:UND1:290:X
caput FBCK:FB05:TR05:M3USED 0
caput FBCK:FB05:TR05:M3CAMODE 1

caput FBCK:FB05:TR05:M4DEVNAME FILE:/data/TR05/BPMS:UND1:390:X
caput FBCK:FB05:TR05:M4USED 0
caput FBCK:FB05:TR05:M4CAMODE 1

caput FBCK:FB05:TR05:M5DEVNAME FILE:/data/TR05/BPMS:UND1:490:X
caput FBCK:FB05:TR05:M5USED 1
caput FBCK:FB05:TR05:M5CAMODE 1

caput FBCK:FB05:TR05:M6DEVNAME FILE:/data/TR05/BPMS:UND1:590:X
caput FBCK:FB05:TR05:M6USED 1
caput FBCK:FB05:TR05:M6CAMODE 1

caput FBCK:FB05:TR05:M7DEVNAME FILE:/data/TR05/BPMS:UND1:690:X
caput FBCK:FB05:TR05:M7USED 1
caput FBCK:FB05:TR05:M7CAMODE 1

caput FBCK:FB05:TR05:M8DEVNAME FILE:/data/TR05/BPMS:UND1:790:X
caput FBCK:FB05:TR05:M8USED 1
caput FBCK:FB05:TR05:M8CAMODE 1

caput FBCK:FB05:TR05:M9DEVNAME FILE:/data/TR05/BPMS:UND1:890:X
caput FBCK:FB05:TR05:M9USED 1
caput FBCK:FB05:TR05:M9CAMODE 1

caput FBCK:FB05:TR05:M10DEVNAME FILE:/data/TR05/BPMS:UND1:990:X
caput FBCK:FB05:TR05:M10USED 1
caput FBCK:FB05:TR05:M10CAMODE 1

caput FBCK:FB05:TR05:M11DEVNAME FILE:/data/TR05/BPMS:UND1:1090:X
caput FBCK:FB05:TR05:M11USED 1
caput FBCK:FB05:TR05:M11CAMODE 1

caput FBCK:FB05:TR05:M12DEVNAME FILE:/data/TR05/BPMS:UND1:100:Y
caput FBCK:FB05:TR05:M12USED 0
caput FBCK:FB05:TR05:M12CAMODE 1

caput FBCK:FB05:TR05:M13DEVNAME FILE:/data/TR05/BPMS:UND1:190:Y
caput FBCK:FB05:TR05:M13USED 0
caput FBCK:FB05:TR05:M13CAMODE 1

caput FBCK:FB05:TR05:M14DEVNAME FILE:/data/TR05/BPMS:UND1:290:Y
caput FBCK:FB05:TR05:M14USED 0
caput FBCK:FB05:TR05:M14CAMODE 1

caput FBCK:FB05:TR05:M15DEVNAME FILE:/data/TR05/BPMS:UND1:390:Y
caput FBCK:FB05:TR05:M15USED 0
caput FBCK:FB05:TR05:M15CAMODE 1

caput FBCK:FB05:TR05:M16DEVNAME FILE:/data/TR05/BPMS:UND1:490:Y
caput FBCK:FB05:TR05:M16USED 1
caput FBCK:FB05:TR05:M16CAMODE 1

caput FBCK:FB05:TR05:M17DEVNAME FILE:/data/TR05/BPMS:UND1:590:Y
caput FBCK:FB05:TR05:M17USED 1
caput FBCK:FB05:TR05:M17CAMODE 1

caput FBCK:FB05:TR05:M18DEVNAME FILE:/data/TR05/BPMS:UND1:690:Y
caput FBCK:FB05:TR05:M18USED 1
caput FBCK:FB05:TR05:M18CAMODE 1

caput FBCK:FB05:TR05:M19DEVNAME FILE:/data/TR05/BPMS:UND1:790:Y
caput FBCK:FB05:TR05:M19USED 1
caput FBCK:FB05:TR05:M19CAMODE 1

caput FBCK:FB05:TR05:M20DEVNAME FILE:/data/TR05/BPMS:UND1:890:Y
caput FBCK:FB05:TR05:M20USED 1
caput FBCK:FB05:TR05:M20CAMODE 1

caput FBCK:FB05:TR05:M21DEVNAME FILE:/data/TR05/BPMS:UND1:990:Y
caput FBCK:FB05:TR05:M21USED 1
caput FBCK:FB05:TR05:M21CAMODE 1

caput FBCK:FB05:TR05:M22DEVNAME FILE:/data/TR05/BPMS:UND1:1090:Y
caput FBCK:FB05:TR05:M22USED 1
caput FBCK:FB05:TR05:M22CAMODE 1

caput FBCK:FB05:TR05:M23USED 0
caput FBCK:FB05:TR05:M24USED 0
caput FBCK:FB05:TR05:M25USED 0
caput FBCK:FB05:TR05:M26USED 0
caput FBCK:FB05:TR05:M27USED 0
caput FBCK:FB05:TR05:M28USED 0
caput FBCK:FB05:TR05:M29USED 0
caput FBCK:FB05:TR05:M30USED 0
caput FBCK:FB05:TR05:M31USED 0
caput FBCK:FB05:TR05:M32USED 0
caput FBCK:FB05:TR05:M33USED 0
caput FBCK:FB05:TR05:M34USED 0
caput FBCK:FB05:TR05:M35USED 0
caput FBCK:FB05:TR05:M36USED 0
caput FBCK:FB05:TR05:M37USED 0
caput FBCK:FB05:TR05:M38USED 0
caput FBCK:FB05:TR05:M39USED 0
caput FBCK:FB05:TR05:M40USED 0

# Reference orbit
caput -a FBCK:FB05:TR05:REFORBIT 30 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

# States
caput FBCK:FB05:TR05:S1NAME X Position
caput FBCK:FB05:TR05:S1USED 1

caput FBCK:FB05:TR05:S2NAME X Angle
caput FBCK:FB05:TR05:S2USED 1

caput FBCK:FB05:TR05:S3NAME Y Position
caput FBCK:FB05:TR05:S3USED 1

caput FBCK:FB05:TR05:S4NAME Y Angle
caput FBCK:FB05:TR05:S4USED 1

caput FBCK:FB05:TR05:S5USED 0
caput FBCK:FB05:TR05:S6USED 0
caput FBCK:FB05:TR05:S7USED 0
caput FBCK:FB05:TR05:S8USED 0
caput FBCK:FB05:TR05:S9USED 0
caput FBCK:FB05:TR05:S10USED 0

# Actuators
caput FBCK:FB05:TR05:A1DEVNAME FILE:/data/TR05/XCOR:LTU1:738:BCTRL
caput FBCK:FB05:TR05:A1USED 1
caput FBCK:FB05:TR05:A1CAMODE 1

caput FBCK:FB05:TR05:A2DEVNAME FILE:/data/TR05/XCOR:LTU1:818:BCTRL
caput FBCK:FB05:TR05:A2USED 1
caput FBCK:FB05:TR05:A2CAMODE 1

caput FBCK:FB05:TR05:A3DEVNAME FILE:/data/TR05/XCOR:LTU1:878:BCTRL
caput FBCK:FB05:TR05:A3USED 1
caput FBCK:FB05:TR05:A3CAMODE 1

caput FBCK:FB05:TR05:A4DEVNAME FILE:/data/TR05/YCOR:LTU1:747:BCTRL
caput FBCK:FB05:TR05:A4USED 1
caput FBCK:FB05:TR05:A4CAMODE 1

caput FBCK:FB05:TR05:A5DEVNAME FILE:/data/TR05/YCOR:LTU1:837:BCTRL
caput FBCK:FB05:TR05:A5USED 1
caput FBCK:FB05:TR05:A5CAMODE 1

caput FBCK:FB05:TR05:A6DEVNAME FILE:/data/TR05/YCOR:LTU1:857:BCTRL
caput FBCK:FB05:TR05:A6USED 1
caput FBCK:FB05:TR05:A6CAMODE 1

caput FBCK:FB05:TR05:A7CAMODE 0
caput FBCK:FB05:TR05:A8CAMODE 0
caput FBCK:FB05:TR05:A9CAMODE 0
caput FBCK:FB05:TR05:A10CAMODE 0

# Energy
caput -a FBCK:FB05:TR05:ACTENERGY 6 4.9108 5.7678 5.7678 4.7127 5.5258 5.5258
caput -a FBCK:FB05:TR05:ACTREF 10 -0.000880512 0.0039126 0.0127461 0.00485299 0 0 0 0 0 0

#caput -a FBCK:FB05:TR05:POLYVALS 264     -0.0000    0.0000   -0.0000    0.0000   -0.0000    1.0000   -0.0000    0.0000   -0.0004    0.0049   -0.0299    1.0934   -0.0000    0.0006   -0.0120    0.1344   -0.8241    3.6267    0.0000   -0.0011    0.0221   -0.2227    1.1045   -0.8766    0.0001   -0.0033    0.0659   -0.6531    3.1613   -4.2754    0.0001   -0.0031    0.0643   -0.6820    3.6775   -6.7934    0.0001   -0.0062    0.1304   -1.3729    7.3232  -14.3940    0.0000   -0.0008    0.0247   -0.3785    2.8832   -7.6175   -0.0000    0.0001    0.0155   -0.3922    3.7021  -11.3019   -0.0002    0.0076   -0.1378    1.1428   -3.8469    2.7612   -0.0004    0.0172   -0.3180    2.7678  -10.6528   12.5153         0         0         0         0         0         0   -0.0000    0.0001   -0.0016    0.0184   -0.1115    4.2189   -0.0000    0.0020   -0.0431    0.4837   -2.9677   17.2052    0.0001   -0.0065    0.1352   -1.4172    7.6561   -6.2781    0.0004   -0.0190    0.3861   -3.9112   19.8025  -22.6442     0.0004   -0.0190    0.4066   -4.4521   25.5507  -45.4041    0.0008   -0.0416    0.8809   -9.4642   52.4478  -98.9903    0.0001   -0.0053    0.1814   -2.9544   24.5486  -62.6295    0.0000   -0.0057    0.2511   -4.5439   39.0905 -106.8755   -0.0012    0.0567   -1.0131    8.0799  -22.2240    2.0434   -0.0026    0.1240   -2.2594   18.9516  -64.1733   51.5340   -0.0000    0.0000   -0.0000    0.0000   -0.0000    1.0000    0.0000   -0.0001    0.0016   -0.0174    0.0981    0.7446    0.0000   -0.0008    0.0163   -0.1806    1.0849   -2.2806    0.0000   -0.0024    0.0500   -0.5390    3.0595   -7.0631   -0.0000    0.0006   -0.0101    0.0504    0.2412   -2.2786   -0.0001    0.0024   -0.0417    0.3157   -0.6634   -2.1588   -0.0001    0.0060   -0.1170    1.1138   -4.9365    6.9072   -0.0003    0.0135   -0.2661    2.5646  -11.7825   18.7766   -0.0002    0.0097   -0.2006    2.0638  -10.3577   18.8415   -0.0003    0.0147   -0.3100    3.2476  -16.7362   32.0880    0.0000   -0.0008   -0.0120    0.4810   -4.5323   12.4918         0         0         0         0         0         0    0.0000   -0.0002    0.0034   -0.0365    0.2104    3.2864    0.0001   -0.0027    0.0585   -0.6477    3.8774   -3.9500    0.0001   -0.0074    0.1543   -1.6340    8.9732  -10.0060    0.0001   -0.0070    0.1586   -1.8732   12.0816  -22.7187    0.0003   -0.0171    0.3764   -4.2764   25.7888  -50.9026   -0.0001    0.0034   -0.0235   -0.4960    9.2785  -28.4963   -0.0003    0.0116   -0.1453    0.0760   11.4902  -44.7035   -0.0010    0.0496   -0.9300    8.0926  -28.4436   27.7260   -0.0021    0.1009   -1.9125   17.1240  -66.7087   83.6786   -0.0022    0.1107   -2.2129   21.4120  -95.3630  150.6021


#   -0.0000    0.0000   -0.0000    0.0000   -0.0000    1.0000
#   -0.0000    0.0000   -0.0004    0.0049   -0.0299    1.0934
#   -0.0000    0.0006   -0.0120    0.1344   -0.8241    3.6267
#    0.0000   -0.0011    0.0221   -0.2227    1.1045   -0.8766
#    0.0001   -0.0033    0.0659   -0.6531    3.1613   -4.2754
#    0.0001   -0.0031    0.0643   -0.6820    3.6775   -6.7934
#    0.0001   -0.0062    0.1304   -1.3729    7.3232  -14.3940
#    0.0000   -0.0008    0.0247   -0.3785    2.8832   -7.6175
#   -0.0000    0.0001    0.0155   -0.3922    3.7021  -11.3019
#   -0.0002    0.0076   -0.1378    1.1428   -3.8469    2.7612
#   -0.0004    0.0172   -0.3180    2.7678  -10.6528   12.5153
#         0         0         0         0         0         0
#   -0.0000    0.0001   -0.0016    0.0184   -0.1115    4.2189
#   -0.0000    0.0020   -0.0431    0.4837   -2.9677   17.2052
#    0.0001   -0.0065    0.1352   -1.4172    7.6561   -6.2781
#    0.0004   -0.0190    0.3861   -3.9112   19.8025  -22.6442 
#    0.0004   -0.0190    0.4066   -4.4521   25.5507  -45.4041
#    0.0008   -0.0416    0.8809   -9.4642   52.4478  -98.9903
#    0.0001   -0.0053    0.1814   -2.9544   24.5486  -62.6295
#    0.0000   -0.0057    0.2511   -4.5439   39.0905 -106.8755
#   -0.0012    0.0567   -1.0131    8.0799  -22.2240    2.0434
#   -0.0026    0.1240   -2.2594   18.9516  -64.1733   51.5340
#   -0.0000    0.0000   -0.0000    0.0000   -0.0000    1.0000
#    0.0000   -0.0001    0.0016   -0.0174    0.0981    0.7446
#    0.0000   -0.0008    0.0163   -0.1806    1.0849   -2.2806
#    0.0000   -0.0024    0.0500   -0.5390    3.0595   -7.0631
#   -0.0000    0.0006   -0.0101    0.0504    0.2412   -2.2786
#   -0.0001    0.0024   -0.0417    0.3157   -0.6634   -2.1588
#   -0.0001    0.0060   -0.1170    1.1138   -4.9365    6.9072
#   -0.0003    0.0135   -0.2661    2.5646  -11.7825   18.7766
#   -0.0002    0.0097   -0.2006    2.0638  -10.3577   18.8415
#   -0.0003    0.0147   -0.3100    3.2476  -16.7362   32.0880
#    0.0000   -0.0008   -0.0120    0.4810   -4.5323   12.4918
#         0         0         0         0         0         0
#    0.0000   -0.0002    0.0034   -0.0365    0.2104    3.2864
#    0.0001   -0.0027    0.0585   -0.6477    3.8774   -3.9500
#    0.0001   -0.0074    0.1543   -1.6340    8.9732  -10.0060
#    0.0001   -0.0070    0.1586   -1.8732   12.0816  -22.7187
#    0.0003   -0.0171    0.3764   -4.2764   25.7888  -50.9026
#   -0.0001    0.0034   -0.0235   -0.4960    9.2785  -28.4963
#   -0.0003    0.0116   -0.1453    0.0760   11.4902  -44.7035
#   -0.0010    0.0496   -0.9300    8.0926  -28.4436   27.7260
#   -0.0021    0.1009   -1.9125   17.1240  -66.7087   83.6786
#   -0.0022    0.1107   -2.2129   21.4120  -95.3630  150.6021




# Must set these up in order to have the config app work
caput FBCK:FB05:TR05:MEASNUM 22
caput FBCK:FB05:TR05:ACTNUM 6
caput FBCK:FB05:TR05:STATENUM 4
caput FBCK:FB05:TR05:PGAIN 0.1

# Enable loop
caput FBCK:FB05:TR05:INSTALLED 1
#caput FBCK:FB05:TR05:STATE 1

